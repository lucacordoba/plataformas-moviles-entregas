<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Lista de Contactos - DOM y JavaScript</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .favorito span {
        color: goldenrod;
        font-weight: bold;
      }

      .acciones button {
        margin-left: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container my-4">
      <h1 class="mb-3">Lista de Contactos</h1>
      <div class="card">
        <div class="card-body">
          <div class="mb-3">
            <input
              id="buscador"
              class="form-control"
              placeholder="Buscar por nombre, apellido o teléfono"
            />
          </div>

          <div class="d-flex gap-2 mb-3">
            <select id="ordenar" class="form-select w-auto">
              <option value="nombre">Ordenar por Nombre</option>
              <option value="apellido">Ordenar por Apellido</option>
            </select>
            <button id="btn-favoritos" class="btn btn-warning btn-sm">
              Ver Favoritos
            </button>
            <button id="btn-eliminar-seleccion" class="btn btn-danger btn-sm">
              Eliminar Seleccionados
            </button>
          </div>

          <ul id="lista-contactos" class="list-group mb-3"></ul>

          <hr />

          <h2 class="h5">Nuevo Contacto</h2>
          <form id="form-contacto">
            <div class="input-group mb-3">
              <input
                type="text"
                id="input-nombre"
                class="form-control"
                placeholder="Nombre"
                required
              />
              <input
                type="text"
                id="input-apellido"
                class="form-control"
                placeholder="Apellido"
                required
              />
              <input
                type="text"
                id="input-telefono"
                class="form-control"
                placeholder="Teléfono"
                required
              />
            </div>
            <button class="btn btn-primary" type="submit">
              Agregar Contacto
            </button>
          </form>
        </div>
      </div>
    </div>

    <script>
      let contactos = JSON.parse(localStorage.getItem("contactos")) || [
        {
          nombre: "Juan",
          apellido: "Perez",
          telefono: "123456",
          favorito: false,
        },
      ];
      let mostrarSoloFavoritos = false;

      function guardar() {
        localStorage.setItem("contactos", JSON.stringify(contactos));
      }

      function agregarContacto(nombre, apellido, telefono) {
        contactos.push({ nombre, apellido, telefono, favorito: false });
        guardar();
        mostrarListado();
      }

      function editarContacto(index) {
        const nuevoNombre = prompt("Nuevo nombre:", contactos[index].nombre);
        const nuevoApellido = prompt(
          "Nuevo apellido:",
          contactos[index].apellido
        );
        const nuevoTelefono = prompt(
          "Nuevo teléfono:",
          contactos[index].telefono
        );

        if (nuevoNombre && nuevoApellido && nuevoTelefono) {
          contactos[index].nombre = nuevoNombre;
          contactos[index].apellido = nuevoApellido;
          contactos[index].telefono = nuevoTelefono;
          guardar();
          mostrarListado();
        }
      }

      function eliminarContacto(index) {
        contactos.splice(index, 1);
        guardar();
        mostrarListado();
      }

      function mostrarListado() {
        const lista = document.getElementById("lista-contactos");
        lista.innerHTML = "";

        const criterio = document.getElementById("ordenar").value;
        const busqueda = document
          .getElementById("buscador")
          .value.toLowerCase();

        let filtrados = contactos
          .filter((c) => !mostrarSoloFavoritos || c.favorito)
          .filter(
            (c) =>
              c.nombre.toLowerCase().includes(busqueda) ||
              c.apellido.toLowerCase().includes(busqueda) ||
              c.telefono.toLowerCase().includes(busqueda)
          )
          .sort((a, b) => a[criterio].localeCompare(b[criterio]));

        filtrados.forEach((c, index) => {
          const li = document.createElement("li");
          li.className =
            "list-group-item d-flex justify-content-between align-items-center";

          const chk = document.createElement("input");
          chk.type = "checkbox";
          chk.className = "form-check-input me-2";

          const span = document.createElement("span");
          span.textContent = `${c.nombre} ${c.apellido} - ${c.telefono}`;

          const btnFav = document.createElement("button");
          btnFav.textContent = c.favorito ? "★" : "☆";
          btnFav.className = "btn btn-sm btn-outline-warning";
          btnFav.addEventListener("click", () => {
            c.favorito = !c.favorito;
            guardar();
            mostrarListado();
          });

          const btnEditar = document.createElement("button");
          btnEditar.textContent = "OK";
          btnEditar.className = "btn btn-sm btn-outline-primary";
          btnEditar.addEventListener("click", () =>
            editarContacto(contactos.indexOf(c))
          );

          const btnEliminar = document.createElement("button");
          btnEliminar.textContent = "x";
          btnEliminar.className = "btn btn-sm btn-outline-danger";
          btnEliminar.addEventListener("click", () =>
            eliminarContacto(contactos.indexOf(c))
          );

          const acciones = document.createElement("div");
          acciones.className = "acciones";
          acciones.append(btnFav, btnEditar, btnEliminar);

          li.append(chk, span, acciones);
          lista.appendChild(li);
        });
      }

      document
        .getElementById("form-contacto")
        .addEventListener("submit", (e) => {
          e.preventDefault();
          const nombre = document.getElementById("input-nombre").value;
          const apellido = document.getElementById("input-apellido").value;
          const telefono = document.getElementById("input-telefono").value;

          agregarContacto(nombre, apellido, telefono);

          e.target.reset();
        });

      document
        .getElementById("ordenar")
        .addEventListener("change", mostrarListado);
      document
        .getElementById("buscador")
        .addEventListener("input", mostrarListado);
      document.getElementById("btn-favoritos").addEventListener("click", () => {
        mostrarSoloFavoritos = !mostrarSoloFavoritos;
        mostrarListado();
      });
      document
        .getElementById("btn-eliminar-seleccion")
        .addEventListener("click", () => {
          const checks = document.querySelectorAll(
            "#lista-contactos input[type=checkbox]:checked"
          );
          const aEliminar = Array.from(checks).map(
            (chk) => chk.nextSibling.textContent
          );
          contactos = contactos.filter(
            (c) =>
              !aEliminar.includes(`${c.nombre} ${c.apellido} - ${c.telefono}`)
          );
          guardar();
          mostrarListado();
        });

      mostrarListado();
    </script>
  </body>
</html>
